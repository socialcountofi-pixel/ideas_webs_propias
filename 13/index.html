<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• Dragon Ball Explorer üî•</title>
<style>
:root {
  --orange: #ff9800;
  --dark: #0b0b0b;
  --gray: #1c1c1c;
  --yellow: #ffca28;
}

body {
  background-color: var(--dark);
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
  margin: 0;
  padding: 1rem;
}

h1 { color: var(--orange); text-shadow: 0 0 15px var(--orange); }

.buscador {
  position: relative;
  margin: 1rem auto;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
  max-width: 600px;
}

input { flex: 1; padding: 0.6rem; border: none; border-radius: 5px; outline: none; font-size: 1rem; min-width: 200px; }
button {
  background: var(--orange);
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 0.6rem 1rem;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
button:hover { background: #e68900; }

.suggestions {
  position: absolute;
  top: 110%;
  left: 0;
  right: 0;
  background: var(--gray);
  border-radius: 5px;
  box-shadow: 0 0 5px var(--orange);
  max-height: 220px;
  overflow-y: auto;
  z-index: 5;
}

.suggestion-item {
  padding: 0.6rem;
  cursor: pointer;
  border-bottom: 1px solid #333;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: 0.2s;
}

.suggestion-item img { width: 40px; height: 40px; border-radius: 5px; object-fit: cover; }
.suggestion-item:hover { background-color: var(--orange); color: #000; }

.container { display: flex; justify-content: center; flex-wrap: wrap; gap: 2rem; margin-top: 2rem; }

.card {
  background: var(--gray);
  border-radius: 10px;
  padding: 1rem;
  max-width: 400px;
  box-shadow: 0 0 10px var(--orange);
  transition: transform 0.3s;
  text-align: left;
}
.card:hover { transform: scale(1.03); }
.card img { width: 100%; max-height: 300px; object-fit: contain; border-radius: 10px; }

.planet, .transformations { margin-top: 2rem; padding: 1rem; border: 2px solid var(--orange); border-radius: 10px; background: #111; max-width: 950px; margin-left: auto; margin-right: auto; }

.planet img { border-radius: 10px; width: 100%; max-width: 300px; object-fit: contain; }

.forms, .planet-characters { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 1rem; padding-bottom: 0.5rem; }

.form-card, .planet-char {
  background: #222;
  border-radius: 8px;
  padding: 0.5rem;
  width: 180px;
  box-shadow: 0 0 6px var(--orange);
  cursor: pointer;
  transition: transform 0.2s;
  flex: 0 0 auto;
}
.form-card:hover, .planet-char:hover { transform: scale(1.05); }
.form-card img, .planet-char img { width: 100%; height: 180px; object-fit: contain; border-radius: 6px; }

.error { color: red; margin-top: 1rem; }
.loading { margin-top: 1rem; color: var(--orange); }

.data-grid { margin-top: 1rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem 1rem; font-size: 0.95rem; }
.data-grid p { margin: 0; padding: 0.2rem 0; }

.subsection-title { color: var(--yellow); margin-top: 1rem; }

@media (max-width: 768px) {
  .card, .planet, .transformations { width: 90%; }
  h1 { font-size: 1.6rem; }
}

@media (max-width: 480px) {
  .buscador { flex-direction: column; }
  button { width: 100%; }
}
</style>
</head>
<body>
<h1>üî• Dragon Ball Explorer üî•</h1>

<div class="buscador">
  <button onclick="anteriorPersonaje()">‚¨ÖÔ∏è</button>
  <input type="text" id="searchInput" placeholder="Buscar personaje o planeta..." oninput="mostrarSugerencias(this.value)">
  <button onclick="buscarPersonaje()">Buscar</button>
  <button onclick="siguientePersonaje()">‚û°Ô∏è</button>
  <div id="suggestions" class="suggestions"></div>
</div>

<p id="errorMsg" class="error"></p>
<p id="loadingMsg" class="loading"></p>

<div class="container" id="characters"></div>
<div class="planet" id="planet"></div>
<div class="transformations" id="transformations"></div><script>
const charactersContainer = document.getElementById("characters");
const planetDiv = document.getElementById("planet");
const transformationsDiv = document.getElementById("transformations");
const errorMsg = document.getElementById("errorMsg");
const loadingMsg = document.getElementById("loadingMsg");
const suggestionsDiv = document.getElementById("suggestions");
const searchInput = document.getElementById("searchInput");

const API_BASE = "https://dragonball-api.com/api"; // Ajustar seg√∫n API real
let currentID = 1;

window.onload = () => buscarPersonaje(currentID);

async function fetchJSON(url) {
  const res = await fetch(url);
  if (!res.ok) throw new Error(`Error al obtener datos: ${res.status}`);
  return await res.json();
}

function limpiarPantalla() {
  charactersContainer.innerHTML = "";
  planetDiv.innerHTML = "";
  transformationsDiv.innerHTML = "";
  errorMsg.textContent = "";
  loadingMsg.textContent = "";
  suggestionsDiv.innerHTML = "";
}

function mostrarCargando(msg) { loadingMsg.textContent = msg; }
function mostrarError(msg) { errorMsg.textContent = msg; }

function renderDataGrid(obj, excludeKeys = ["image"]) {
  return Object.entries(obj)
    .filter(([k, v]) => typeof v !== "object" && v !== null && v !== "" && !excludeKeys.includes(k))
    .map(([k, v]) => `<p><strong>${k}:</strong> ${v}</p>`)
    .join("");
}

// ---- Buscar personaje o planeta ----
async function buscarPersonaje(param) {
  let query = param || searchInput.value.trim();
  if (!query) query = 1;

  limpiarPantalla();
  mostrarError("");
  mostrarCargando("Cargando datos...");

  try {
    let personaje;

    if (!isNaN(query)) {
      personaje = await fetchJSON(`${API_BASE}/characters/${query}`);
    } else {
      // Primero buscamos por personaje
      let data = await fetchJSON(`${API_BASE}/characters?name=${encodeURIComponent(query)}`);
      if (Array.isArray(data) && data.length) {
        personaje = await fetchJSON(`${API_BASE}/characters/${data[0].id}`);
      } else {
        // Si no hay personaje, buscamos planeta
        data = await fetchJSON(`${API_BASE}/planets?name=${encodeURIComponent(query)}`);
        if (!Array.isArray(data) || !data.length) throw new Error("No encontrado");
        const planet = await fetchJSON(`${API_BASE}/planets/${data[0].id}`);
        mostrarPlaneta(planet);
        mostrarCargando("");
        return;
      }
    }

    mostrarCargando("");
    currentID = personaje.id; // actualizar ID actual
    searchInput.value = personaje.name;

    mostrarPersonaje(personaje);

    if (personaje.originPlanet?.id) {
      const planet = await fetchJSON(`${API_BASE}/planets/${personaje.originPlanet.id}`);
      mostrarPlaneta(planet);
    }

    personaje.transformations?.length
      ? mostrarTransformaciones(personaje.transformations)
      : transformationsDiv.innerHTML = `<h3>‚ö° Este personaje no tiene transformaciones registradas</h3>`;

  } catch (err) {
    mostrarError("‚ùå No se encontr√≥ el personaje o planeta.");
    mostrarCargando("");
    console.error(err);
  }
}

// ---- Renderizado ----
function mostrarPersonaje(personaje) {
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <img src="${personaje.image}" alt="${personaje.name}">
    <h2>${personaje.name}</h2>
    <div class="data-grid">${renderDataGrid(personaje)}</div>
  `;
  charactersContainer.appendChild(card);
}

function mostrarPlaneta(planet) {
  planetDiv.innerHTML = `
    <h2>üåç Planeta: ${planet.name}</h2>
    ${planet.image ? `<img src="${planet.image}" alt="${planet.name}">` : ""}
    <div class="data-grid">${renderDataGrid(planet)}</div>
  `;

  if (planet.characters?.length) {
    const charsContainer = document.createElement("div");
    charsContainer.className = "planet-characters";
    planet.characters.forEach(c => {
      const charDiv = document.createElement("div");
      charDiv.className = "planet-char";
      charDiv.innerHTML = `<img src="${c.image}" alt="${c.name}"><p>${c.name}</p>`;
      charDiv.onclick = () => buscarPersonaje(c.id);
      charsContainer.appendChild(charDiv);
    });
    planetDiv.innerHTML += `<h3 class="subsection-title">üëä Habitantes de este planeta</h3>`;
    planetDiv.appendChild(charsContainer);
  }
}

function mostrarTransformaciones(transformations) {
  transformationsDiv.innerHTML = "<h3>‚ö° Transformaciones</h3>";
  const formsContainer = document.createElement("div");
  formsContainer.className = "forms";

  transformations.forEach(f => {
    const formCard = document.createElement("div");
    formCard.className = "form-card";
    formCard.innerHTML = `
      <img src="${f.image}" alt="${f.name}">
      <p><strong>${f.name}</strong></p>
      ${renderDataGrid(f)}
    `;
    formsContainer.appendChild(formCard);
  });

  transformationsDiv.appendChild(formsContainer);
}

// ---- Sugerencias ----
async function mostrarSugerencias(texto) {
  suggestionsDiv.innerHTML = "";
  if (texto.length < 2) return;

  try {
    const chars = await fetchJSON(`${API_BASE}/characters?name=${encodeURIComponent(texto)}`);
    const planets = await fetchJSON(`${API_BASE}/planets?name=${encodeURIComponent(texto)}`);

    const items = [...(chars||[]), ...(planets||[])].slice(0, 10);

    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "suggestion-item";
      div.innerHTML = `<img src="${item.image || ''}" alt="${item.name}"><span>${item.name}</span>`;
      div.onclick = () => {
        searchInput.value = item.name;
        buscarPersonaje(item.name);
      };
      suggestionsDiv.appendChild(div);
    });
  } catch (err) {
    console.error("Error al cargar sugerencias:", err);
  }
}

// ---- Navegaci√≥n por ID ----
function siguientePersonaje() { buscarPersonaje(currentID + 1); }
function anteriorPersonaje() { if (currentID > 1) buscarPersonaje(currentID - 1); }
</script>
</body>
</html>
