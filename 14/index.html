<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåü Dragon Ball Explorer Ultra √âpico üåü</title>
<style>
:root { --orange:#ff9800; --dark:#0b0b0b; --gray:#1c1c1c; --yellow:#ffca28; --aura:#fffa00; --energy:#f5f500; }
body { background: var(--dark); color:#fff; font-family: 'Segoe UI', sans-serif; text-align:center; margin:0; padding:1rem; transition: background 1s; overflow-x:hidden; }
h1 { color: var(--orange); text-shadow:0 0 20px var(--orange); }
.buscador { position:relative; margin:1rem auto; display:flex; justify-content:center; flex-wrap:wrap; gap:0.5rem; max-width:600px; }
input { flex:1; padding:0.6rem; border:none; border-radius:5px; outline:none; font-size:1rem; min-width:200px; }
button { background: var(--orange); color:#fff; border:none; border-radius:5px; padding:0.6rem 1rem; cursor:pointer; font-weight:bold; transition:0.3s; }
button:hover{ background:#e68900; }
.suggestions { position:absolute; top:110%; left:0; right:0; background:var(--gray); border-radius:5px; box-shadow:0 0 5px var(--orange); max-height:220px; overflow-y:auto; z-index:5; }
.suggestion-item { padding:0.6rem; cursor:pointer; border-bottom:1px solid #333; text-align:left; display:flex; align-items:center; gap:0.5rem; transition:0.2s; opacity:0; transform:translateX(-20px); animation:fadeIn 0.3s forwards; }
.suggestion-item img{ width:40px; height:40px; border-radius:5px; object-fit:cover; }
.suggestion-item:hover{ background-color:var(--orange); color:#000; }
.container{ display:flex; justify-content:center; flex-wrap:wrap; gap:2rem; margin-top:2rem; position:relative; }
.card{ background:var(--gray); border-radius:10px; padding:1rem; max-width:400px; box-shadow:0 0 15px var(--orange); transition: transform 0.3s, box-shadow 0.3s; text-align:left; opacity:0; animation:fadeIn 0.6s forwards; position:relative; overflow:hidden; }
.card:hover{ transform:scale(1.05); box-shadow:0 0 35px var(--aura), 0 0 60px var(--orange); }
.card img{ width:100%; max-height:300px; object-fit:contain; border-radius:10px; }
.aura { position:absolute; top:-20%; left:-20%; width:140%; height:140%; border-radius:50%; background: radial-gradient(circle, var(--aura) 0%, transparent 70%); animation: auraPulse 1s infinite alternate; pointer-events:none; mix-blend-mode:screen; }
.energy-sparks { position:absolute; width:2px; height:2px; background:var(--energy); border-radius:50%; animation: sparkMove 1s infinite; opacity:0; }
.planet, .transformations{ margin-top:2rem; padding:1rem; border:2px solid var(--orange); border-radius:10px; background:#111; max-width:950px; margin-left:auto; margin-right:auto; opacity:0; animation:fadeIn 0.7s forwards; }
.planet img{ border-radius:10px; width:100%; max-width:300px; object-fit:contain; }
.forms, .planet-characters{ display:flex; overflow-x:auto; gap:1rem; padding-bottom:0.5rem; scroll-behavior:smooth; }
.forms::-webkit-scrollbar, .planet-characters::-webkit-scrollbar{ height:8px; }
.forms::-webkit-scrollbar-thumb, .planet-characters::-webkit-scrollbar-thumb{ background:var(--orange); border-radius:4px; }
.form-card, .planet-char{ background:#222; border-radius:8px; padding:0.5rem; width:180px; box-shadow:0 0 6px var(--orange); cursor:pointer; transition: transform 0.3s, box-shadow 0.3s, filter 0.3s; flex:0 0 auto; opacity:0; animation:fadeIn 0.5s forwards; position:relative; overflow:hidden; }
.form-card:hover, .planet-char:hover{ transform:scale(1.07); box-shadow:0 0 25px var(--aura),0 0 40px var(--orange); filter:brightness(1.2); }
.form-card img, .planet-char img{ width:100%; height:180px; object-fit:contain; border-radius:6px; }
.error{ color:red; margin-top:1rem; }
.loading{ margin-top:1rem; color:var(--orange); }
.data-grid{ margin-top:1rem; display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:0.5rem 1rem; font-size:0.95rem; }
.data-grid p{ margin:0; padding:0.2rem 0; }
.subsection-title{ color:var(--yellow); margin-top:1rem; }
@keyframes fadeIn{ to{ opacity:1; transform:translateX(0); } }
@keyframes auraPulse{ from{ transform: scale(0.9); opacity:0.6; } to{ transform: scale(1.1); opacity:1; } }
@keyframes sparkMove{ 0%{ transform: translate(0,0); opacity:1;} 50%{ transform: translate(50px,-50px); opacity:0.5;} 100%{ transform: translate(100px,0); opacity:0; } }
@media(max-width:768px){ .card,.planet,.transformations{ width:90%; } h1{ font-size:1.6rem; } }
@media(max-width:480px){ .buscador{ flex-direction:column; } button{ width:100%; } }
</style>
</head>
<body>
<h1>üåü Dragon Ball Explorer Ultra √âpico üåü</h1>
<div class="buscador">
<button onclick="anteriorPersonaje()">‚¨ÖÔ∏è</button>
<input type="text" id="searchInput" placeholder="Buscar personaje o planeta..." oninput="delayedSugerencias(this.value)">
<button onclick="buscarPersonaje()">Buscar</button>
<button onclick="siguientePersonaje()">‚û°Ô∏è</button>
<div id="suggestions" class="suggestions"></div>
</div>
<p id="errorMsg" class="error"></p>
<p id="loadingMsg" class="loading"></p>
<div class="container" id="characters"></div>
<div class="planet" id="planet"></div>
<div class="transformations" id="transformations"></div>

<!-- Coloca este c√≥digo dentro de la misma p√°gina que antes, reemplazando el <script> anterior -->
<script>
const charactersContainer=document.getElementById("characters");
const planetDiv=document.getElementById("planet");
const transformationsDiv=document.getElementById("transformations");
const errorMsg=document.getElementById("errorMsg");
const loadingMsg=document.getElementById("loadingMsg");
const suggestionsDiv=document.getElementById("suggestions");
const searchInput=document.getElementById("searchInput");
const body=document.body;

const API_BASE="https://dragonball-api.com/api";
let currentID=1;
let suggestionTimeout=null;

window.onload=()=>buscarPersonaje(currentID);

async function fetchJSON(url){ const res=await fetch(url); if(!res.ok) throw new Error(`Error: ${res.status}`); return await res.json(); }

function limpiarPantalla(){ charactersContainer.innerHTML=""; planetDiv.innerHTML=""; transformationsDiv.innerHTML=""; errorMsg.textContent=""; loadingMsg.textContent=""; suggestionsDiv.innerHTML=""; }

function mostrarCargando(msg){ loadingMsg.textContent=msg; }
function mostrarError(msg){ errorMsg.textContent=msg; }

function renderDataGrid(obj,excludeKeys=["image"]){ return Object.entries(obj).filter(([k,v])=>typeof v!=="object" && v!==null && v!=="" && !excludeKeys.includes(k)).map(([k,v])=>`<p><strong>${k}:</strong> ${v}</p>`).join(""); }

async function buscarPersonaje(param){
  let query=param||searchInput.value.trim();
  if(!query) query=1;
  limpiarPantalla();
  mostrarCargando("Cargando datos...");
  mostrarError("");

  try{
    let personaje=null;
    let planeta=null;

    if(!isNaN(query)){
      personaje=await fetchJSON(`${API_BASE}/characters/${query}`);
    }else{
      const charData=await fetchJSON(`${API_BASE}/characters?name=${encodeURIComponent(query)}`);
      const planetData=await fetchJSON(`${API_BASE}/planets?name=${encodeURIComponent(query)}`);
      if(Array.isArray(charData)&&charData.length) personaje=await fetchJSON(`${API_BASE}/characters/${charData[0].id}`);
      else if(Array.isArray(planetData)&&planetData.length) planeta=await fetchJSON(`${API_BASE}/planets/${planetData[0].id}`);
      else throw new Error("No encontrado");
    }

    mostrarCargando("");

    if(personaje){
      currentID=personaje.id;
      searchInput.value=personaje.name;
      body.style.background=`linear-gradient(135deg, #0b0b0b 0%, #111 100%), url(${personaje.image}) center/cover no-repeat`;
      mostrarPersonaje(personaje);

      if(personaje.originPlanet?.id){
        planeta=await fetchJSON(`${API_BASE}/planets/${personaje.originPlanet.id}`);
      }

      personaje.transformations?.length
        ? mostrarTransformaciones(personaje.transformations)
        : transformationsDiv.innerHTML=`<h3>‚ö° Este personaje no tiene transformaciones registradas</h3>`;
      
      kamehamehaEffect(); // Activar efecto Kamehameha
    }

    if(planeta){
      mostrarPlaneta(planeta);
    }

  }catch(err){ mostrarError("‚ùå No se encontr√≥ personaje o planeta."); mostrarCargando(""); console.error(err); }
}

function mostrarPersonaje(personaje){
  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`<div class="aura"></div><img src="${personaje.image}" alt="${personaje.name}"><h2>${personaje.name}</h2><div class="data-grid">${renderDataGrid(personaje)}</div>`;
  charactersContainer.appendChild(card);

  for(let i=0;i<15;i++){
    const spark=document.createElement("div");
    spark.className="energy-sparks";
    spark.style.top=Math.random()*80+"%";
    spark.style.left=Math.random()*80+"%";
    spark.style.animationDelay=(Math.random()*2)+"s";
    card.appendChild(spark);
  }
}

function mostrarPlaneta(planet){
  planetDiv.innerHTML=`<h2>üåç Planeta: ${planet.name}</h2>${planet.image?`<img src="${planet.image}" alt="${planet.name}">`:""}<div class="data-grid">${renderDataGrid(planet)}</div>`;
  if(planet.characters?.length){
    const charsContainer=document.createElement("div");
    charsContainer.className="planet-characters";
    planet.characters.forEach(c=>{
      const charDiv=document.createElement("div");
      charDiv.className="planet-char";
      charDiv.innerHTML=`<img src="${c.image}" alt="${c.name}"><p>${c.name}</p>`;
      charDiv.onclick=()=>buscarPersonaje(c.id);
      charsContainer.appendChild(charDiv);
    });
    planetDiv.innerHTML+=`<h3 class="subsection-title">üëä Habitantes de este planeta</h3>`;
    planetDiv.appendChild(charsContainer);
  }
}

function mostrarTransformaciones(transformations){
  transformationsDiv.innerHTML="<h3>‚ö° Transformaciones</h3>";
  const formsContainer=document.createElement("div");
  formsContainer.className="forms";
  transformations.forEach(f=>{
    const formCard=document.createElement("div");
    formCard.className="form-card";
    formCard.innerHTML=`<img src="${f.image}" alt="${f.name}"><p><strong>${f.name}</strong></p>${renderDataGrid(f)}`;
    formsContainer.appendChild(formCard);
  });
  transformationsDiv.appendChild(formsContainer);
}

function delayedSugerencias(texto){
  clearTimeout(suggestionTimeout);
  suggestionTimeout=setTimeout(()=>mostrarSugerencias(texto),300);
}

async function mostrarSugerencias(texto){
  suggestionsDiv.innerHTML="";
  if(texto.length<2) return;
  try{
    const chars=await fetchJSON(`${API_BASE}/characters?name=${encodeURIComponent(texto)}`);
    const planets=await fetchJSON(`${API_BASE}/planets?name=${encodeURIComponent(texto)}`);
    const items=[...(chars||[]), ...(planets||[])].slice(0,10);
    items.forEach(item=>{
      const div=document.createElement("div");
      div.className="suggestion-item";
      div.innerHTML=`<img src="${item.image||''}" alt="${item.name}"><span>${item.name}</span>`;
      div.onclick=()=>{
        searchInput.value=item.name;
        buscarPersonaje(item.name);
      };
      suggestionsDiv.appendChild(div);
    });
  }catch(err){ console.error("Error sugerencias:",err); }
}

function siguientePersonaje(){ buscarPersonaje(currentID+1); }
function anteriorPersonaje(){ if(currentID>1) buscarPersonaje(currentID-1); }

// ----- EFECTO KAMEHAMEHA -----
function kamehamehaEffect(){
  const kameDiv=document.createElement("div");
  kameDiv.style.position="fixed";
  kameDiv.style.left="50%";
  kameDiv.style.top="50%";
  kameDiv.style.transform="translate(-50%,-50%)";
  kameDiv.style.width="10px";
  kameDiv.style.height="10px";
  kameDiv.style.borderRadius="50%";
  kameDiv.style.background="radial-gradient(circle, #00f 0%, #0ff 70%)";
  kameDiv.style.zIndex=9999;
  kameDiv.style.pointerEvents="none";
  kameDiv.style.opacity=0.8;
  kameDiv.style.boxShadow="0 0 50px #0ff,0 0 100px #00f";
  body.appendChild(kameDiv);

  let scale=1;
  const interval=setInterval(()=>{
    scale+=0.15;
    kameDiv.style.transform=`translate(-50%,-50%) scale(${scale})`;
    kameDiv.style.opacity-=0.05;
    if(scale>10){
      clearInterval(interval);
      kameDiv.remove();
    }
  },50);

  // Vibraci√≥n del fondo
  let t=0;
  const vib=setInterval(()=>{
    t++;
    body.style.transform=`translate(${Math.sin(t*0.5)*5}px,${Math.cos(t*0.5)*5}px)`;
    if(t>20){
      clearInterval(vib);
      body.style.transform="";
    }
  },30);
}
</script>
</body>
</html>
